<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Performance Backtester</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen p-4">
  <div class="bg-white p-6 rounded-lg shadow-md max-w-md w-full text-center">
    <h1 class="text-2xl font-bold mb-4">Stock Performance Backtester</h1>
    <input id="symbol" class="border p-2 mb-3 w-full" placeholder="Stock Symbol (e.g., AAPL)" />
    <input id="date" type="date" class="border p-2 mb-3 w-full" />
    <input id="amount" type="number" class="border p-2 mb-3 w-full" placeholder="Investment Amount ($)" />
    <button id="calculateBtn" class="bg-blue-600 text-white p-2 rounded w-full hover:bg-blue-700">Calculate Performance</button>
    <div id="result" class="mt-4 text-left text-sm"></div>
    <p class="text-xs mt-4 text-gray-400">Made with Gemini</p>
  </div>

  <script>
    const apiKey = "687fec5d04c700.10558204"; // EOD API key
    const resultDiv = document.getElementById("result");

    async function fetchStockData(symbol, fromDate) {
      const url = `https://eodhistoricaldata.com/api/eod/${symbol}.US?from=${fromDate}&to=${new Date().toISOString().split('T')[0]}&api_token=${apiKey}&period=d`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Price data fetch failed");
      return res.json();
    }

    async function fetchDividends(symbol, fromDate) {
      const url = `https://eodhistoricaldata.com/api/div/${symbol}.US?from=${fromDate}&api_token=${apiKey}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Dividend data fetch failed");
      return res.json();
    }

    function formatUSD(val) {
      return `$${val.toFixed(2)}`;
    }

    document.getElementById("calculateBtn").addEventListener("click", async () => {
      const symbol = document.getElementById("symbol").value.trim().toUpperCase();
      const fromDate = document.getElementById("date").value;
      const amount = parseFloat(document.getElementById("amount").value);

      if (!symbol || !fromDate || isNaN(amount) || amount <= 0) {
        resultDiv.innerHTML = `<p class="text-red-500">‚ùå Please enter valid symbol, date, and amount.</p>`;
        return;
      }

      resultDiv.innerHTML = "üîÑ Calculating...";

      try {
        const prices = await fetchStockData(symbol, fromDate);
        const dividends = await fetchDividends(symbol, fromDate);

        if (prices.length < 2) throw new Error("Not enough price data");

        const start = prices[0];
        const end = prices[prices.length - 1];
        const startPrice = start.adjusted_close || start.close;
        const endPrice = end.adjusted_close || end.close;

        const dividendSum = dividends.reduce((sum, d) => sum + parseFloat(d.adjusted_amount || d.amount || 0), 0);

        const shares = amount / startPrice;
        const finalValue = (shares * endPrice) + (shares * dividendSum);
        const returnPct = ((finalValue - amount) / amount) * 100;

        resultDiv.innerHTML = `
          <p><strong>${symbol}</strong> grew from ${formatUSD(startPrice)} to ${formatUSD(endPrice)} since <strong>${fromDate}</strong>.</p>
          <p>Dividends received: <strong>${formatUSD(dividendSum * shares)}</strong></p>
          <p>Total value: <strong>${formatUSD(finalValue)}</strong></p>
          <p class="text-green-600 mt-2"><strong>Return: ${returnPct.toFixed(2)}%</strong></p>
        `;
      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = `<p class="text-red-500">‚ùå Error: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
