<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Performance Backtester</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="card bg-white rounded-lg shadow-lg p-8 max-w-md w-full">
    <h1 class="text-2xl font-bold mb-4 text-center">Stock Performance Backtester</h1>
    <label class="block mb-2">Stock Symbol</label>
    <input id="symbol" class="w-full p-2 border rounded mb-4" placeholder="e.g., AAPL" />

    <label class="block mb-2">Purchase Date</label>
    <input id="purchaseDate" type="date" class="w-full p-2 border rounded mb-4" />

    <label class="block mb-2">Investment Amount ($)</label>
    <input id="amount" type="number" class="w-full p-2 border rounded mb-4" />

    <button id="calculateBtn" class="bg-blue-600 text-white w-full py-2 rounded hover:bg-blue-700">
      Calculate Performance
    </button>

    <div id="results" class="mt-6 text-center hidden">
      <p class="font-semibold" id="resultSummary"></p>
      <p id="resultReturnPercentage" class="text-green-600 font-bold text-lg mt-2"></p>
    </div>

    <p id="error" class="text-red-600 text-sm mt-4 text-center hidden"></p>

    <p class="text-xs text-center text-gray-400 mt-6">Made with Gemini</p>
  </div>

  <script>
    const calculateBtn = document.getElementById("calculateBtn");
    const resultsSection = document.getElementById("results");
    const resultSummary = document.getElementById("resultSummary");
    const resultReturnPercentage = document.getElementById("resultReturnPercentage");
    const errorDisplay = document.getElementById("error");

    async function fetchPrice(symbol, date) {
      const url = `https://eodhistoricaldata.com/api/eod/${symbol}.US?from=${date}&to=${date}&api_token=687fec5d04c700.10558204&fmt=json`;
      const res = await fetch(url);
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0 || !data[0].adjusted_close) {
        throw new Error("No price data found.");
      }

      return data[0].adjusted_close;
    }

    async function fetchLatestPrice(symbol) {
      const url = `https://eodhistoricaldata.com/api/real-time/${symbol}.US?api_token=687fec5d04c700.10558204&fmt=json`;
      const res = await fetch(url);
      const data = await res.json();

      if (!data.close) {
        throw new Error("No latest price found.");
      }

      return data.close;
    }

    calculateBtn.addEventListener("click", async () => {
      const symbol = document.getElementById("symbol").value.toUpperCase();
      const purchaseDate = document.getElementById("purchaseDate").value;
      const amount = parseFloat(document.getElementById("amount").value);

      resultsSection.classList.add("hidden");
      errorDisplay.classList.add("hidden");

      if (!symbol || !purchaseDate || isNaN(amount) || amount <= 0) {
        errorDisplay.textContent = "Please enter all fields correctly.";
        errorDisplay.classList.remove("hidden");
        return;
      }

      try {
        const purchasePrice = await fetchPrice(symbol, purchaseDate);
        const currentPrice = await fetchLatestPrice(symbol);

        const sharesBought = amount / purchasePrice;
        const currentValue = sharesBought * currentPrice;
        const returnPercentage = ((currentValue - amount) / amount) * 100;

        resultSummary.textContent = `${symbol} has grown from $${purchasePrice.toFixed(2)} to $${currentPrice.toFixed(2)} since ${purchaseDate}.`;
        resultReturnPercentage.textContent = `Return: ${returnPercentage.toFixed(2)}%`;

        resultsSection.classList.remove("hidden");
      } catch (err) {
        errorDisplay.textContent = `❌ Error: ${err.message}`;
        errorDisplay.classList.remove("hidden");
      }
    });
  </script>
</body>
</html>
